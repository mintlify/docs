---
title: "工作流"
description: "通过定时或事件触发的 agent 任务自动化文档维护。"
keywords: ["自动化", "自动", "cron", "自动更新"]
---

<Info>
  工作流适用于[企业版计划](https://mintlify.com/pricing?ref=agent)。

  你最多可以拥有 10 个活跃的工作流。
</Info>

工作流按照设定的时间表自动运行 agent，或在你指定的仓库发生 push 时触发。每个工作流定义一个 agent 的 prompt 和运行触发器。

当工作流运行时，agent 会克隆指定的仓库作为上下文，执行 prompt，然后创建拉取请求或直接将更改推送到你的部署分支。

## 创建工作流文件

在文档仓库根目录的 `.mintlify/workflows/` 目录中创建 `.md` 文件。每个文件定义一个工作流。

工作流文件使用 YAML frontmatter 配置工作流，后跟用于 agent 的 Markdown prompt。

```markdown .mintlify/workflows/update-changelog.md
---
name: Update changelog
on:
  cron: "0 9 * * 1"
context:
  - repo: your-org/your-product
automerge: false
---

Review all changes since the last changelog update. Draft a new changelog post with any new features, bug fixes, or breaking changes.

Include information about what a change is and how it affects users.

Do not include any internal-only information or minor changes like bumping package versions or updating documentation.

Success criteria: Someone who reads the changelog knows the most up to date information about the product including what changed and whether or not it affects them.
```

### Frontmatter 字段

| 字段 | 必填 | 描述 |
|-------|----------|-------------|
| `name` | 是 | 在控制面板中显示的名称。 |
| `on` | 是 | 触发器配置。 |
| `context` | 否 | 工作流运行时作为参考克隆的仓库。 |
| `automerge` | 否 | 默认为 `false`，会创建拉取请求。如果为 `true`，则直接将更改推送到你的部署分支。 |

你必须在 `context` 或 `on.push.repo` 字段中列出的每个仓库上安装 Mintlify GitHub 应用。在 Mintlify 控制面板的 [GitHub 应用](https://dashboard.mintlify.com/settings/organization/github-app)页面添加新仓库。

<Frame>
  <img src="/images/github/app-repos-light.png" alt="GitHub 应用页面显示两个组织的已连接仓库。" className="block dark:hidden" />
  <img src="/images/github/app-repos-dark.png" alt="GitHub 应用页面显示两个组织的已连接仓库（深色模式）。" className="hidden dark:block" />
</Frame>

## 触发器

每个工作流必须使用 `on` 字段定义一个触发器。

### 按计划（cron）

使用 cron 表达式按定期计划运行工作流。所有计划均以 UTC 时间运行。

工作流会在计划时间后 10 分钟内排队，可能需要最多 10 分钟才能运行。

```yaml
on:
  cron: "0 9 * * 1"
```

该值是标准的 5 字段 cron 表达式，格式为 `分钟 小时 日 月 星期`。使用 [crontab.guru](https://crontab.guru) 等工具来创建和验证计划。

| 表达式 | 计划 |
|------------|----------|
| `"0 9 * * 1"` | 每周一 UTC 时间 9:00 |
| `"0 0 1 * *"` | 每月第一天 UTC 时间午夜 |
| `"0 8 * * 1-5"` | 工作日 UTC 时间 8:00 |

### 合并时

当拉取请求合并到指定的仓库和分支时运行工作流。

```yaml
on:
  push:
    - repo: your-org/your-product
      branch: main
```

- `repo`：GitHub 仓库，格式为 `owner/repo`。
- `branch`（可选）：要监视合并的分支。如果不指定分支，工作流会在合并到仓库的默认分支时触发。

一个工作流可以监视多个仓库或分支的合并。

```yaml
on:
  push:
    - repo: your-org/your-product
    - repo: your-org/another-repo
      branch: release
```

## 参考仓库

使用 `context` 在工作流运行时让 agent 获得对其他仓库的读取权限。当你的 prompt 需要审查文档仓库之外的代码或内容时，这很有用。

```yaml
context:
  - repo: your-org/your-product
  - repo: your-org/design-system
```

## 自动合并更改

默认情况下，agent 会为每次工作流运行创建拉取请求，以便你在更改上线前进行审查。设置 `automerge: true` 可直接将更改推送到部署分支，而无需创建拉取请求。

```yaml
automerge: true
```

## Prompts

有效的 prompt 专注于一项任务并有明确的预期结果。由于 agent 的非确定性特性，工作流总会有一些变化，但你可以通过遵循以下最佳实践来提高工作流输出的一致性。

- 描述你希望 agent 达成的结果。
- 包含成功标准。
- 指定你希望 agent 使用的上下文。
- 将复杂任务拆分为多个步骤或多个工作流。

## 工作流示例

### 风格审核

当文档拉取请求合并时运行，在风格指南违规累积之前捕获它们。此示例工作流会自动修复风格指南违规，并在 PR 正文中列出需要人工判断的违规。

```markdown .mintlify/workflows/style-audit.md
---
name: Style audit
on:
  push:
    - repo: your-org/your-docs
      branch: main
automerge: false
---

Review all MDX files changed in the last merged PR against the style guide at `path/to/style-guide`.

Open a pull request to resolve any style violations that can be fixed automatically. For any edits that require judgment or nuance, note them in the PR body with the specific lines, rule violations, and suggested fixes.

Success criteria:
- All style violations have a proposed resolution.
- No new style violations are introduced.

## Important

- Do not change content meaning. Only correct style violations.
- Skip any files in language subdirectories (`es/`, `fr/`, `zh/`).
```

### 为新功能起草文档

当拉取请求合并到你的产品仓库时运行，识别任何新功能或 API 所需的文档更新。

```markdown .mintlify/workflows/draft-feature-docs.md
---
name: Draft docs for new features
on:
  push:
    - repo: your-org/your-product
      branch: main
context:
  - repo: your-org/your-docs
automerge: false
---

Review the diff from the last merged PR in `your-org/your-product`. Identify any new features, APIs, or other changes that require documentation.

For each new addition, draft documentation updates that explain what it does, when to use it, and how to configure it. Include a code example where relevant.

Success criteria: After reading any new or updated documentation, users understand what the feature is, if it applies to tasks they do, and how to use it.

## Important

- Only document changes that affect end users. Skip internal refactors or dependency updates.
- Match the style and structure of existing docs pages.
```

### 更新 API 参考

当拉取请求合并到你的产品仓库时运行，保持 API 参考页面与产品代码同步。当端点或参数发生变化时，此工作流会更新文档中的相应内容。

```markdown .mintlify/workflows/update-api-reference.md
---
name: Update API reference
on:
  push:
    - repo: your-org/your-product
      branch: main
context:
  - repo: your-org/your-docs
automerge: false
---

Review the diff from the last merged PR in `your-org/your-product` for changes to API endpoints, parameters, response shapes, or error codes.

Update the corresponding API specifications or pages in the docs to reflect the changes. Include updated parameter descriptions, type information, and examples where affected.

Success criteria: All API specifications and pages are up to date with the changes in the product repository.

## Important

- If a parameter or endpoint was removed, mark it as deprecated rather than deleting it unless the code explicitly removes it with no deprecation period.
- If no API changes were introduced, do nothing.
```

### 跟踪翻译滞后

每周运行，比较英文源文件与其翻译，识别落后的页面。

要使用此工作流，请将示例语言子目录（`es/`、`fr/`、`zh/`）更新为你实际的语言子目录。

```markdown .mintlify/workflows/translation-lag.md
---
name: Track translation lag
on:
  cron: "0 9 * * 3"
---

Compare the English MDX files in the repo against their counterparts in the `es/`, `fr/`, and `zh/` subdirectories. Use git history to identify English files updated more recently than their translations.

Open a pull request that lists pages that are out of sync, organized by language. For each page, include the date of the last English update and a brief summary of what changed so translators have context on what to update.

Success criteria: Any discrepancies between the English and translated files are identified and listed in the pull request.

## Important

- If a translated file does not exist, flag it as missing rather than out of sync.
- Group findings by language, then by how far out of date they are (most stale first).
```

### SEO 和元数据审核

每周运行，检查元数据缺失或较弱的页面，并创建包含改进的拉取请求。此示例工作流检查缺失的 `description` frontmatter。编辑工作流以检查你为文档优先考虑的其他元数据或内容问题。

```markdown .mintlify/workflows/seo-audit.md
---
name: SEO and metadata audit
on:
  cron: "0 9 * * 1"
automerge: false
---

Audit all MDX files in the docs for SEO and metadata quality. Check for:

- Missing or empty `description` frontmatter
- Descriptions that are too short (under 50 characters) or too long (over 160 characters)

Open a pull request with improvements for any issues found. Write descriptions that accurately summarize the page content in plain language.

Success criteria: All pages have up to date descriptions that accurately summarize the page content in plain language.

## Important

- Only update frontmatter. Do not change page content.
- If all pages have complete and reasonable metadata, do nothing.
```

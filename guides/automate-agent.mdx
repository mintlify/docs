---
title: "Tutorial: Auto-update documentation when code is merged"
description: "Use the agent API and a n8n workflow to automatically update your documentation after merging a pull request"
---

## What you will build
An automation that updates your documentation when a pull request is merged. The workflow watches a GitHub repository for merged PRs and then calls the agent API to update your documentation in a separate repository.

## Prerequisites

- n8n workspace
- Mintlify admin API key
- Mintlify Pro or Custom plan
- Admin access to the GitHub repositories for the source and documentation projects
- GitHub personal access tokens for both the source and documentation repositories

### Get your admin API key

1. Navigate to the [API keys](https://dashboard.mintlify.com/settings/organization/api-keys) page in your dashboard.
2. Select **Create Admin API Key**.
3. Copy the key and save it securely.

### Get your GitHub personal access token

1. In GitHub, navigate to **Settings**.
2. Select **Developer settings**.
3. Select **Personal access tokens**.
4. Select **Tokens (classic)**.
5. Select **Generate new token (classic)**.
6. Select these scopes:
    - `repo` (full control of private repositories)
    - `admin:repo_hook` (if you want n8n to create webhooks)
7. Generate and save the token securely.

For more information, see [Creating a personal access token (classic)](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens?versionId=free-pro-team%40latest&productId=account-and-profile#creating-a-personal-access-token-classic) in the GitHub documentation.

## Understanding the two-repository setup

This workflow connects two separate repositories.

**Code repository**: Where your application code lives and where developers create and merge pull requests. You'll set up the GitHub webhook on this repository. Examples include your backend API, frontend app, SDK, or CLI tool.

**Documentation repository**: Where your Mintlify documentation lives and is connected to your Mintlify project. The agent API will create pull requests with documentation updates in this repository.

The documentation repository could be a separate repository or a `/docs` folder in your monorepo.

### Workflow overview

1. Developer merges a pull request in the code repository
2. n8n receives the webhook from GitHub
3. n8n sends the pull request context to the agent API
4. The agent creates a pull request in the documentation repository
5. n8n comments on the original code repository pull request

## Build the workflow

### Create the webhook trigger

1. In n8n, create a new workflow.
2. Add a webhook node.
3. Configure the webhook:
    - HTTP Method: `POST`
    - Path: `github-code-changes` (or any unique path)
    - Authentication: None
    - Respond: Immediately
4. Save the workflow.
5. Copy the production webhook URL. It will look like: `https://your-n8n-instance.app.n8n.cloud/webhook/github-code-changes`

### Set up the GitHub webhook

<Warning>Set this up on your code repository, not your documentation repository.</Warning>

1. Navigate to your code repository on GitHub.
2. Select **Settings**.
3. Select **Webhooks**.
4. Select **Add webhook**.
5. Configure the webhook:
    - Payload URL: Paste your n8n webhook URL
    - Content type: `application/json`
    - Which events would you like to trigger this webhook?
        - Select **Let me select individual events**
        - Select **Pull requests** only
    - Select **Active**
6. Select **Add webhook**.

GitHub will send a test ping. Verify the webhook is working by checking the executions in n8n.

### Filter for merged pull requests

Add a code node after the webhook to filter for merged pull requests and extract the relevant information.

1. Add a code node.
2. Name it "Filter merged PRs".
3. Set mode to **Run Once for All Items**.
4. Add this JavaScript:

```javascript Filter merged PRs
const webhookData = $input.first().json;

// Only continue if this is a closed AND merged PR
if (webhookData.action !== "closed" || webhookData.pull_request?.merged !== true) {
  return [];
}

// Extract information
const pullRequest = webhookData.pull_request;
const repository = webhookData.repository;
const sender = webhookData.sender;

// Build message for agent
const agentMessage = `Update documentation for changes in ${repository.name}.

**PR #${pullRequest.number}: ${pullRequest.title}**

**Repository:** ${repository.full_name}
**Branch:** ${pullRequest.head.ref}
**Files Changed:** ${pullRequest.changed_files}
**Author:** ${sender.login}

**PR Description:**
${pullRequest.body || "No description provided"}

Please review these code changes and update the relevant documentation.`;

return {
  json: {
    prTitle: pullRequest.title,
    prBody: pullRequest.body || "No description provided",
    prNumber: pullRequest.number,
    prUrl: pullRequest.html_url,
    prAuthor: sender.login,
    codeRepoName: repository.full_name,
    codeRepoShortName: repository.name,
    branchName: pullRequest.head.ref,
    filesChanged: pullRequest.changed_files,
    agentMessage: agentMessage
  }
};
```

This code stops the workflow if the pull request wasn't merged, extracts all relevant information from the GitHub webhook, and creates a message for the agent API.

### Call the agent API

Add an HTTP request node to create a documentation job.

1. Add an HTTP request node.
2. Name it "Create agent job".
3. Configure the request:
    - Method: `POST`
    - URL: `https://api.mintlify.com/v1/agent/YOUR_PROJECT_ID/job` (replace `YOUR_PROJECT_ID` with your project ID)
    - Authentication: Generic Credential Type → Header Auth
        - Create a new credential:
            - Name: `Authorization`
            - Value: `Bearer mint_YOUR_API_KEY` (replace with your API key)
    - Send Body: On
    - Body Content Type: JSON
    - JSON:

```json
{
  "branch": "docs-update-from-{{ $json.codeRepoShortName }}-pr-{{ $json.prNumber }}",
  "messages": [
    {
      "role": "system",
      "content": "{{ $json.agentMessage }}"
    }
  ]
}
```

The agent will create a pull request in your documentation repository using a descriptive branch name that includes the source repository and pull request number.

### Comment on the code repository pull request

Add another HTTP request node to comment on the original pull request.

1. Add an HTTP request node.
2. Name it "Comment on code PR".
3. Configure the request:
    - Method: `POST`
    - URL: `https://api.github.com/repos/{{ $('Filter Merged PRs').item.json.codeRepoName }}/issues/{{ $('Filter Merged PRs').item.json.prNumber }}/comments`
    - Authentication: Generic Credential Type → Header Auth
        - Create a new credential:
            - Name: `Authorization`
            - Value: `Bearer YOUR_GITHUB_TOKEN` (replace with your token)
    - Add a second header:
        - Name: `User-Agent`
        - Value: `n8n-mintlify-docs-bot`
    - Send Body: On
    - Body Content Type: JSON
    - JSON:

```json
{
  "body": "Documentation update triggered. Branch: `docs-update-from-{{ $('Filter Merged PRs').item.json.codeRepoShortName }}-pr-{{ $('Filter Merged PRs').item.json.prNumber }}`. Check your documentation repository for the pull request."
}
```

### Activate the workflow

1. Save your workflow.
2. Toggle it to active.

Your workflow is now monitoring your code repository for merged pull requests.

## Test the automation

1. Create a test branch in your code repository:
   ```bash
   git checkout -b test-docs-automation
   ```

2. Make a small change and commit it:
   ```bash
   git add .
   git commit -m "Test: trigger docs automation"
   git push origin test-docs-automation
   ```

3. Open a pull request on GitHub with a descriptive description.
4. Merge the pull request.

### Verify the automation

Check the following to confirm the workflow is working:

- **n8n executions**: You should see a new execution with all nodes completed successfully.
- **Code repository**: Your merged pull request should have a comment from the bot with the documentation branch name.
- **Mintlify dashboard**: You should see a new agent job in progress or completed.
- **Documentation repository**: After a minute or two, check for a new branch and pull request with documentation updates.

## Troubleshooting

### Webhook not triggering

- Verify the workflow is active in n8n.
- Check GitHub repository Settings → Webhooks → Recent Deliveries for the response code.
- Confirm the webhook URL matches your n8n webhook URL exactly.

### Workflow stops at filter node

The pull request may not have been merged. Check the node execution input data to verify `action` is `"closed"` and `pull_request.merged` is `true`.

### 401 error from agent API

- Verify your API key starts with `mint_`.
- Check the Authorization header is formatted as `Bearer mint_yourkey`.
- Confirm the API key is for the correct Mintlify organization.

### 401 error from GitHub

- Verify your token has the `repo` scope.
- Check that the token hasn't expired.
- Confirm you included the `User-Agent` header in the GitHub request.

### Agent creates pull request in wrong repository

Check that your Mintlify project is connected to your documentation repository, not your code repository.
